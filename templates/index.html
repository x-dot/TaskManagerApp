<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 700px; margin: 2rem auto; padding: 0 1rem; background-color: #f4f4f9; color: #333; }
        h1 { text-align: center; color: #444; margin-bottom: 1.5rem; }

        /* --- Toolbar Styles --- */
        .toolbar {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Search Section (Left) */
        .search-group {
            display: flex;
            gap: 5px;
            border-right: 2px solid #eee; /* Î”Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÏ„Î¹ÎºÎ® Î³ÏÎ±Î¼Î¼Î® */
            padding-right: 10px;
        }
        #searchTaskId { width: 60px; text-align: center; }
        .btn-search { background-color: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; padding: 10px 15px; }
        .btn-search:hover { background-color: #138496; }

        /* Add Task Section (Right) */
        .input-group {
            display: flex;
            gap: 10px;
            flex-grow: 1; /* Î Î¹Î¬Î½ÎµÎ¹ Ï„Î¿Î½ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ Ï‡ÏÏÎ¿ */
        }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        #title { flex-grow: 1; } /* ÎŸ Ï„Î¯Ï„Î»Î¿Ï‚ Î¼ÎµÎ³Î±Î»ÏÎ½ÎµÎ¹ ÏŒÏƒÎ¿ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ */
        
        button#add-btn { padding: 10px 20px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        button#add-btn:hover { background-color: #218838; }

        /* --- List Styles --- */
        ul { list-style: none; padding: 0; margin-top: 1.5rem; }
        li { background: white; border-bottom: 1px solid #eee; padding: 1rem; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s; }
        li:first-child { border-top-left-radius: 8px; border-top-right-radius: 8px; }
        li:last-child { border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; border-bottom: none; }
        li:hover { background-color: #fafafa; }
        .delete-btn { background-color: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-left: 10px; }
        .delete-btn:hover { background-color: #c82333; }

        /* --- Search Result Box --- */
        #searchResult { margin-top: 15px; }
        .found-task { 
            border: 2px solid #28a745; 
            background: #e9f7ef; 
            padding: 15px; 
            border-radius: 8px; 
            position: relative;
        }
        .close-search {
            position: absolute; top: 5px; right: 10px; cursor: pointer; font-weight: bold; color: #666;
        }
    </style>
</head>
<body>

    <h1>ğŸ“‹ Task Manager</h1>
    
    <div class="toolbar">
        
        <div class="search-group" title="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¼Îµ ID">
            <input type="number" id="searchTaskId" placeholder="ID">
            <button class="btn-search" onclick="searchTask()">ğŸ”</button>
        </div>

        <div class="input-group">
            <input type="text" id="title" placeholder="New task..." required>
            <input type="date" id="deadline">
            <button id="add-btn" onclick="addTask()">â•</button>
        </div>

    </div>

    <div id="searchResult"></div>

    <ul id="task-list"></ul>

    <script>
        const API_URL = '/tasks';

        // 1. Î¦ÏŒÏÏ„Ï‰ÏƒÎ· ÎµÏÎ³Î±ÏƒÎ¹ÏÎ½
        async function loadTasks() {
            const response = await fetch(API_URL);
            const tasks = await response.json();
            const list = document.getElementById('task-list');
            list.innerHTML = '';
            tasks.forEach(task => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div>
                        <span style="font-weight:bold; color:#555;">#${task.id}</span> 
                        <strong>${task.title}</strong> <br>
                        <small style="color: #888;">ğŸ“… ${task.deadline || 'No deadline'}</small>
                    </div>
                    <button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button>
                `;
                list.appendChild(li);
            });
        }

        // 2. Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Task
        async function addTask() {
            const title = document.getElementById('title').value;
            const deadline = document.getElementById('deadline').value;
            if (!title) return alert("Î“ÏÎ¬ÏˆÎµ Î­Î½Î±Î½ Ï„Î¯Ï„Î»Î¿!");

            await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, deadline, username: 'user', description: '' })
            });
            
            document.getElementById('title').value = '';
            document.getElementById('deadline').value = '';
            loadTasks();
        }

        // 3. Î”Î¹Î±Î³ÏÎ±Ï†Î® Task
        async function deleteTask(id) {
            if(confirm('Î£Î¯Î³Î¿Ï…ÏÎ± Î¸Î­Î»ÎµÎ¹Ï‚ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÎ¹Ï‚ Ï„Î¿ task ' + id + ';')) {
                await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                loadTasks();
                // Î‘Î½ ÎµÎ¯Î½Î±Î¹ Î±Î½Î¿Î¹Ï‡Ï„ÏŒ Ï„Î¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ Î³Î¹Î± Î±Ï…Ï„ÏŒ Ï„Î¿ ID, ÎºÎ»ÎµÎ¯ÏƒÏ„Î¿
                document.getElementById('searchResult').innerHTML = '';
            }
        }

        // 4. Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Task
        async function searchTask() {
            const idInput = document.getElementById('searchTaskId');
            const resultDiv = document.getElementById('searchResult');
            const id = idInput.value;

            resultDiv.innerHTML = ''; // ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚

            if (!id) {
                alert("Î Î±ÏÎ±ÎºÎ±Î»Ï Î´ÏÏƒÎµ Î­Î½Î± ID");
                return;
            }

            try {
                const response = await fetch(`/tasks/${id}`);
                
                if (response.status === 404) {
                    resultDiv.innerHTML = '<div style="padding:10px; background:#f8d7da; color:#721c24; border-radius:5px;">âŒ Î¤Î¿ Task Î¼Îµ ID ' + id + ' Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ!</div>';
                    return;
                }

                if (!response.ok) throw new Error('Error');

                const task = await response.json();
                
                // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î¿Ï‚
                resultDiv.innerHTML = `
                    <div class="found-task">
                        <span class="close-search" onclick="this.parentElement.remove()">âœ•</span>
                        <h4>âœ… Î’ÏÎ­Î¸Î·ÎºÎµ: ${task.title}</h4>
                        <p><strong>ID:</strong> ${task.id} | <strong>User:</strong> ${task.username}</p>
                        <p><strong>Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®:</strong> ${task.description || '-'}</p>
                        <p><strong>Î”Î¹Î¿ÏÎ¯Î±:</strong> ${task.deadline}</p>
                    </div>
                `;
            } catch (error) {
                console.error(error);
            }
        }

        // Î‘ÏÏ‡Î¹ÎºÎ® Ï†ÏŒÏÏ„Ï‰ÏƒÎ·
        loadTasks();
    </script>
</body>
</html>